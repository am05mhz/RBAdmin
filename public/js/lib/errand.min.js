var errand=function(e){if(void 0!==this.self)return new errand(e)
if(!this.parse(e))throw"invalid arguments"
var t=[]
for(var s in this.data)t.push(s+"="+this.data[s])
"get"!==this.method?this.formData=t.join("&"):t.length>0&&(this.url+=this.url.indexOf("?")!=-1?"&":"?"+t.join("&")),this.setXhr()}
errand.methods=["get","post","put","delete"],errand.prototype.parse=function(e){if("string"==typeof e&&(e={url:e}),"object"==typeof e&&"string"==typeof e.url)return this.url=e.url,this.method="get",this.json=!1,this.data={},"string"==typeof e.method&&errand.methods.indexOf(e.method.toLowerCase())!=-1&&(this.method=e.method.toLowerCase()),e.json&&(this.json=!0),"object"==typeof e.data&&(this.data=e.data),"object"==typeof e.headers?this.headers=e.headers:this.headers={},this.headers["X-Requested-With"]="XMLHttpRequest",!0},errand.prototype.setXhr=function(){this.xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.xhr.json=this.json,this.cancel=function(e){return this.xhr.abort(),this},this.xhr.callbacks={success:[],error:[]}
for(var e in this.xhr.callbacks)this[e]=function(e){return function(t){return this.xhr.callbacks[e].push(t),this}}(e)
if(this.xhr.call=function(e,t){for(var s=0;s<this.callbacks[e].length;s++)"function"==typeof this.callbacks[e][s]&&this.callbacks[e][s](t)},this.xhr.onreadystatechange=function(){if(4==this.readyState){var e="error",t={status:this.status,message:"unknown",response:this.responseText}
switch(this.status){case 200:var s=this.responseText
if(this.json)try{s=JSON.parse(s)}catch(s){return t.message="invalid json",this.call(e,t),!1}e="success",t=s
break
case 400:t.message="bad request"
break
case 401:t.message="unauthorized"
break
case 403:t.message="forbidden"
break
case 404:t.message="not found"
break
case 500:t.message="internal server error"
break
case 502:t.message="bad gateway"
break
case 504:t.message="gateway timeout"}this.call(e,t)}},this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.headers)for(header in this.headers)this.xhr.setRequestHeader(header,this.headers[header])
this.xhr.send(void 0!==this.formData?this.formData:null)},void 0!==window.module&&module.exports&&(module.exports=errand)
